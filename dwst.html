<!DOCTYPE html>
<!--
Dark WebSocket Terminal

CC0, http://creativecommons.org/publicdomain/zero/1.0/

To the extent possible under law, Dark WebSocket Terminal developers have waived all copyright and related or neighboring rights to Dark WebSocket Terminal.

Dark WebSocket Terminal developers:
Toni Ruottu <toni.ruottu@iki.fi>, Finland 2010

-->
<html>
<head>
<title>Dark WebSocket Terminal 1.1.5</title>
<script>

var ws;

function refreshclock() {
  var time = currenttime();
  document.getElementById('clock1').innerHTML = time;
}

function currenttime() {
  addzero = function(i) {
    if (i < 10) {
      return "0"+i;
    }
    return ""+i;
  };
  var date = new Date();
  return time = addzero(date.getHours()) +":"+ addzero(date.getMinutes())+'<span class="sec">:'+ addzero(date.getSeconds())+'</span>';

}

function log(msg, type) {
  var escaped = msg.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;');
  var time = currenttime();
  document.getElementById('ter1').innerHTML += '<tr><td class="time">'+time+'</td><td class="direction '+type+'">'+type+':</td><td>'+escaped+'</td></tr>';
  var screen = document.getElementById("screen1");
  screen.scrollTop = screen.scrollHeight;
}

function send() {
  var msg = document.getElementById('msg1').value;
  document.getElementById('msg1').value = "";
  log(msg, "sent");
  ws.send(msg);
}

function connect() {
  if (("WebSocket" in window) == false) {
    alert('Your browser does not seem to support websockets.');
    return;
  }
  document.getElementById('open').setAttribute("style", "visibility: hidden;");
  var url = document.getElementById('url1').value;
  var proto = document.getElementById('proto1').value;
  var protostring = ''
  if(proto == '') {
    ws = new WebSocket(url);
  }
  else {
    ws = new WebSocket(url,proto);
    protostring = " (protocol: " + proto + ")"
  }
  history.replaceState({}, "", "?socket=" + url + '&proto=' + proto + '&connected=true');
  ws.onopen = function() {
    document.getElementById('sendbut1').removeAttribute("disabled");
    log("connection established, " + url + protostring, "system");
    document.getElementById('msg1').focus();
  };
  ws.onclose = function() {
    log("connection closed, " + url + protostring, "system");
  };
  ws.onmessage = function(msg) {
    log(msg.data, "received");
  };
  ws.onerror = function() {
    log('websocket error: ' + url + ' ' + protostring, "system");
  };
}

function disconnect()
{
  var url = document.getElementById('url1').value;
  var proto = document.getElementById('proto1').value;
  history.replaceState({}, "", "?socket=" + url + '&proto=' + proto + '&connected=false');
  document.getElementById('sendbut1').setAttribute("disabled", "disabled");
  ws.close();
  document.getElementById('open').removeAttribute("style");
  document.getElementById('url1').focus();
}

function linkfix() {
  document.getElementById("sourcelink").setAttribute("href","view-source:"+location.href);
}

function parseParams() {
    var query = window.location.href.split('?')[1];
    if (query !== undefined) {
        var defs = query.split('&');
    }
    var params = {}
    for (var i in defs) {
        var parts = defs[i].split("=");
        params[parts[0]] = parts[1];
    }
    return params;
}

function init() {
  var params = parseParams();
  var connected = params.connected;
  var socket = params.socket;
  var proto = params.proto;

  linkfix();
  if (proto) {
      document.getElementById('proto1').value = proto
  }
  if (socket) {
      document.getElementById('url1').value = socket
  }
  refreshclock();
  document.getElementById('clock1').removeAttribute("style");
  setInterval( "refreshclock();", 500 );
  if(connected == "true")
  {
    document.getElementById('conbut1').click()
  }
  else
  {
    document.getElementById('open').removeAttribute("style");
    document.getElementById('url1').focus();
  }
}

</script>

<style>

body
{
  height: 100%;
  background-color: #540;
}
h1 a
{
  padding: 0;
  color: #000;
  font-family: serif;
}


.button
{
  width: 5em;
}
.direction
{
  width: 3em;
  text-align: right;
}

.sent
{
  color: #77c;
}

.received
{
  color: #c77;
}

.system
{
  color: #7f7;
}

.time
{
  width: 3em;
}

.sec
{
  color: #777;
}

.label
{
  width: 1em;
}

.protofield
{
  width: 15%;
}

h1
{
  text-align: center;
  font-family: sans-serif;
}
.footer
{
  margin-top: 4em;
  text-align: center;
  font-size: 0.4em;
  font-family: sans-serif;
  color: #ddd;
  padding: 1em;
}

.footer a
{
  color: #ddf;
}
.footer img
{
  width: 5em;
  height: 1.8em;
  padding-right: 1em;
}

table.terminal
{
  background-color: #000;
  color: #ccc;
  font-family: monospace;
}
input[type="text"]
{
  background-color: #444;
  color: #fff;
  font-family: monospace;
  border: thin solid #f00;
}

input[readonly="readonly"]
{
  background-color: #555;
  color: #ddd;

}

#open input[type="text"]
{
  border: thin solid #000;
  width: 100%;
}
.bar2 input[type="text"]
{
  border: thin solid #000;
  width: 100%;
}
input[type="button"]
{
  padding: 0;
  width: 6em;
}

body
{
  margin: 0;
}


.consolebar
{
  position: absolute;
  bottom: 0;
  width: 100%;
  height: 2em;
  background-color: #222;
}

.consolebar .time
{
  font-family: monospace;
  width: 1em;
  color: #ddd;
}

.consolebar .leftpad
{
  padding-left: 1em;
}

.consolebar .rightpad
{
  padding-right: 1em;
}

#screen1
{
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 2em;
  background-color: #000;
  overflow: auto;
  vertical-align: top;
}

#open
{
  background-color: rgba(85, 68, 0, 0.8);
  color: #777;
  border-radius: 15px;
  position: absolute;
  margin: 10%;
  width: 80%;
  border: medium solid #777;
  text-align: center;
  font-family: sans-serif;
  font-size: 0.8em;
}
.bar2
{
  position: absolute;
  bottom: 0;
  left: 0;
  width: 100%;
  height: 2em;
}
.panel
{
  border: medium solid #540;
  border-radius: 5px;
  padding: 1em;
  margin: auto 10%;
  width: 80%;
  background-color: #320;
  text-align: right;
}
.panel .label
{
  width: 3em;
}
</style>
</head>
<body onload="init();" onkeydown="if (event.keyCode == 13) {document.getElementById('sendbut1').click() }else if (event.keyIdentifier == 'U+001B') {disconnect();}">
<div id="screen1" class="screen">
<table id="ter1" class="terminal">
</table>
</div>
<div class="bar2">
<table class="consolebar"><tr>
<td id="clock1" style="color: transparent;" class="time rightpad leftpad">00:00:00</td>
<td><input id="msg1" type="text" value=""></td>
<td class="button rightpad leftpad"><input id="sendbut1" type="button" value="send" disabled="disabled" onClick="send();"></td>
</tr></table>
</div>

<div id="open" style="visibility: hidden;">
<h1><a href="?">Dark WebSocket Terminal</a></h1>
<table class="panel">
<tr><td class="label">socket:</td><td><input type="text" id="url1" value="ws://echo.websocket.org/" onkeydown="if (event.keyCode == 13) document.getElementById('conbut1').click()"></td></tr>
<tr><td>protocol:</td><td><input type="text" id="proto1" value="" onkeydown="if (event.keyCode == 13) document.getElementById('conbut1').click()"></td></tr>
<tr><td colspan="2"><input id="conbut1" type="button" value="connect" onClick="connect();"></td></tr>
</table>

<p xmlns:dct="http://purl.org/dc/terms/" xmlns:vcard="http://www.w3.org/2001/vcard-rdf/3.0#" class="footer"> 
  <a rel="license" href="http://creativecommons.org/publicdomain/zero/1.0/"> 
    <img src="http://i.creativecommons.org/l/zero/1.0/88x31.png" style="border-style: none;" alt="CC0" /></a> 

  To the extent possible under law, <a id="sourcelink" href="" rel="dct:publisher"><span property="dct:title">Dark WebSocket Terminal developers</span></a> 
  have waived all copyright and related or neighboring rights to
  <span property="dct:title">Dark WebSocket Terminal</span>.
</p>
</div>

</body>
</html>
